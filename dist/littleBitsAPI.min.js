(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){window.littleBitsAPI=require("../lib/index")},{"../lib/index":3}],2:[function(require,module,exports){var F=require("./utils");exports.opt_to_pp=opt_to_pp;var table=exports.table={"/devices":{get:{fname:"devices"}},"/devices/{device_id}":{get:{fname:"device"},"delete":{fname:"deactivate"},post:{fname:"activate"},put:{fname:"device_update"}},"/devices/{device_id}/output":{post:{fname:"output"}},"/devices/{device_id}/light":{post:{fname:"light"}},"/subscriptions":{post:{fname:"subscribe"},"delete":{fname:"unsubscribe"},get:{fname:"subscriptions"}}};function opt_to_pp(path,method,pp_name,opts){method=method.toLowerCase();var cust=table[path]&&table[path][method]&&table[path][method][pp_name]||{};var name_used=opts[cust.rename]?cust.rename:pp_name;var value=opts[name_used];return F.isExist(value)?cust.trans?cust.trans(value,name_used):value:null}},{"./utils":8}],3:[function(require,module,exports){var merge=require("merge");var make_method=require("./make-method");var routes=require("./routes");var rutils=require("./route-utils");var root_defaults={host:"https://api-http.littlebitscloud.cc",version:"2"};module.exports=API(root_defaults);function API(base_defaults){var api=routes.reduce(function(acc,route){var name=rutils.calc_fname(route);if(name){acc[name]=make_method(base_defaults,rutils.functionify(route))}return acc},{});api.defaults=function defaults(new_defaults){if(arguments.length===0)return base_defaults;return API(merge({},base_defaults,new_defaults))};return api}module.exports._process_signature=require("./method-process-signature")},{"./make-method":4,"./method-process-signature":5,"./route-utils":6,"./routes":7,merge:24}],4:[function(require,module,exports){var process_signature=require("./method-process-signature");var merge=require("merge");module.exports=make_method;function make_method(base_defaults,f){function todo_name_me(){var args=process_signature(arguments);var opts=merge({},base_defaults,args.overrides);return f.apply(null,[opts,args.cb])}todo_name_me.defaults=function(base_defaults_method){if(arguments.length===0)return base_defaults;return make_method(merge({},base_defaults,base_defaults_method),f)};return todo_name_me}},{"./method-process-signature":5,merge:24}],5:[function(require,module,exports){var snakeify=require("to-snake-case");var transform=require("lodash.transform");var merge=require("merge");var default_cb=console&&console.log&&console.log.bind(console)||function noop(){};module.exports=process_signature;function process_signature(args){var args_={};if(typeof args[0]==="function"){args_.overrides={};args_.cb=args[0]}else if(typeof args[0]==="string"){var overrides=typeof args[1]==="object"?args[1]:null;args_.overrides=merge({device_id:args[0]},normalize_key_case(overrides||{}));args_.cb=overrides?args[2]||default_cb:args[1]||default_cb}else{args_.overrides=normalize_key_case(args[0]||{});args_.cb=args[1]||default_cb}return args_}function normalize_key_case(options){return transform(options,do_snakeify,{});function do_snakeify(o,v,k){o[snakeify(k)]=v}}},{"lodash.transform":23,merge:24,"to-snake-case":28}],6:[function(require,module,exports){var F=require("./utils");var cust=require("./customizations");var sa=require("superagent");exports.calc_fname=route_calc_fname;exports.path_interpolate=route_path_interpolate;exports.functionify=route_functionify;function route_functionify(route){return function(opts,cb){var uri=route_join(opts.host,route_path_interpolate(route,[opts.device_id]));var r=sa(route.method,uri);if(route.auth&&opts.access_token)r.set("Authorization","Bearer "+opts.access_token);r.set("Accept","application/vnd.littlebits.v"+opts.version+"+json");if(opts.payload)r.set(opts.payload);var add_params=param_adder(route.path,route.method,r,opts);if(route.payloadParams.children){route.payloadParams.children.forEach(add_params)}if(route.queryParams.children){route.queryParams.children.forEach(add_params)}r.end(function(err,response){if(err){var error;try{error=JSON.parse(err.response.error.text);error=error.message?error:err.response.error}catch(e){error=err.response.error}return cb(error)}if(response.error)return cb(extract_err(response));cb(null,response.body)})}}function route_path_interpolate(route,path_args){return path_args.reduce(function(path,arg){return path.replace(/{[^}]*}/,arg)},route.path)}function route_calc_fname(route){var custom_name=cust.table[route.path]&&cust.table[route.path][route.method.toLowerCase()]&&cust.table[route.path][route.method.toLowerCase()].fname;return custom_name?custom_name:null}function param_adder(path,method,request,request_opts){return function(param){var value=cust.opt_to_pp(path,method,param.name,request_opts);if(F.isExist(value)){var o={};o[param.name]=value;request[method==="GET"?"query":"send"](o)}}}function route_join(){var path=[];for(var i=0;i<arguments.length;i++){path.push(arguments[i].replace(/^\//,"").replace(/\/$/,""))}return path.join("/")}function extract_err(res){var err=res.error;if(res.body&&res.body.message)err.message=res.body.message;return err}},{"./customizations":2,"./utils":8,superagent:26}],7:[function(require,module,exports){module.exports=[{path:"/ping",method:"GET",auth:false,pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:null},{path:"/devices",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"device_hash",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"update",type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:true,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"PUT",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"update",type:"object",required:true,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:null,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}/light",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"mode",type:"string",required:false,allowedValues:["blink","hold"],disallowedValues:null},{name:"color",type:"string",required:false,allowedValues:["green","yellow","red","blue","purple","white","cyan","clownbarf"],disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/devices/{device_id}/output",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"percent",type:"number",required:null,allowedValues:null,disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:null,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:null,allowedValues:null,disallowedValues:null}]},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/subscriptions",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_events",type:"array",required:null,allowedValues:null,disallowedValues:null,rules:{Includes:[{type:"any",required:false,allowedValues:["amplitude","amplitude:delta:sustain","amplitude:delta:ignite","amplitude:delta:release","amplitude:delta:nap","amplitude:level:active","amplitude:level:idle"],disallowedValues:null}]}}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"}];module.exports=[{path:"/ping",method:"GET",auth:false,pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:null},{path:"/devices",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"device_hash",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"update",type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:true,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"PUT",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"update",type:"object",required:true,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:null,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}/light",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"mode",type:"string",required:false,allowedValues:["blink","hold"],disallowedValues:null},{name:"color",type:"string",required:false,allowedValues:["green","yellow","red","blue","purple","white","cyan","clownbarf"],disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/devices/{device_id}/output",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"percent",type:"number",required:null,allowedValues:null,disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:null,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:null,allowedValues:null,disallowedValues:null}]},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/subscriptions",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_events",type:"array",required:null,allowedValues:null,disallowedValues:null,rules:{Includes:[{type:"any",required:false,allowedValues:["amplitude","amplitude:delta:sustain","amplitude:delta:ignite","amplitude:delta:release","amplitude:delta:nap","amplitude:level:active","amplitude:level:idle"],disallowedValues:null}]}}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"}];module.exports=[{path:"/ping",method:"GET",auth:false,pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:null},{path:"/devices",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"device_hash",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"update",type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:true,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"PUT",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"update",type:"object",required:true,allowedValues:null,disallowedValues:null,children:[{name:"label",type:"string",required:null,allowedValues:null,disallowedValues:null}]}]},responseParams:null,version:"2"},{path:"/devices/{device_id}",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/devices/{device_id}/light",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"mode",type:"string",required:false,allowedValues:["blink","hold"],disallowedValues:null},{name:"color",type:"string",required:false,allowedValues:["green","yellow","red","blue","purple","white","cyan","clownbarf"],disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/devices/{device_id}/output",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"percent",type:"number",required:null,allowedValues:null,disallowedValues:null},{name:"duration_ms",type:"number",required:null,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"GET",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:null,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:null,allowedValues:null,disallowedValues:null}]},payloadParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},responseParams:null,version:"2"},{path:"/subscriptions",method:"POST",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"publisher_events",type:"array",required:null,allowedValues:null,disallowedValues:null,rules:{Includes:[{type:"any",required:false,allowedValues:["amplitude","amplitude:delta:sustain","amplitude:delta:ignite","amplitude:delta:release","amplitude:delta:nap","amplitude:level:active","amplitude:level:idle"],disallowedValues:null}]}}]},responseParams:null,version:"2"},{path:"/subscriptions",method:"DELETE",auth:["bearer"],pathParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},queryParams:{type:"any",required:false,allowedValues:null,disallowedValues:null},payloadParams:{type:"object",required:null,allowedValues:null,disallowedValues:null,children:[{name:"publisher_id",type:"string",required:true,allowedValues:null,disallowedValues:null},{name:"subscriber_id",type:"string",required:true,allowedValues:null,disallowedValues:null}]},responseParams:null,version:"2"}]},{}],8:[function(require,module,exports){function isExist(value){return typeof value!=="undefined"&&value!==null}module.exports={isExist:isExist}},{}],9:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],10:[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}module.exports=arrayEach},{}],11:[function(require,module,exports){var baseIsEqual=require("lodash._baseisequal"),bindCallback=require("lodash._bindcallback"),isArray=require("lodash.isarray"),pairs=require("lodash.pairs");var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var reEscapeChar=/\\(\\)?/g;function baseToString(value){return value==null?"":value+""}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return thisArg===undefined?func:bindCallback(func,thisArg,argCount)}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseGet(object,path,pathKey){if(object==null){return}if(pathKey!==undefined&&pathKey in toObject(object)){path=[pathKey]}var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]]}return index&&index==length?object:undefined}function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=toObject(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,true):result)){return false}}}return true}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){if(object==null){return false}return object[key]===value&&(value!==undefined||key in toObject(object))}}return function(object){return baseIsMatch(object,matchData)}}function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";path=toPath(path);return function(object){if(object==null){return false}var key=pathKey;object=toObject(object);if((isArr||!isCommon)&&!(key in object)){object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false}key=last(path);object=toObject(object)}return object[key]===srcValue?srcValue!==undefined||key in object:baseIsEqual(srcValue,object[key],undefined,true)}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";path=toPath(path);return function(object){return baseGet(object,path,pathKey)}}function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function getMatchData(object){var result=pairs(object),length=result.length;while(length--){result[length][2]=isStrictComparable(result[length][1])}return result}function isKey(value,object){var type=typeof value;if(type=="string"&&reIsPlainProp.test(value)||type=="number"){return true}if(isArray(value)){return false}var result=!reIsDeepProp.test(value);return result||object!=null&&value in toObject(object)}function isStrictComparable(value){return value===value&&!isObject(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value)){return value}var result=[];baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function identity(value){return value}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}module.exports=baseCallback},{"lodash._baseisequal":14,"lodash._bindcallback":15,"lodash.isarray":18,"lodash.pairs":22}],12:[function(require,module,exports){var baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}}}();function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseCreate},{}],13:[function(require,module,exports){var baseFor=createBaseFor();function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while(fromRight?index--:++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseFor},{}],14:[function(require,module,exports){var isArray=require("lodash.isarray"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys");var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]";function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;
if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key=="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseIsEqual},{"lodash.isarray":18,"lodash.istypedarray":20,"lodash.keys":21}],15:[function(require,module,exports){function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function identity(value){return value}module.exports=bindCallback},{}],16:[function(require,module,exports){var funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=getNative},{}],17:[function(require,module,exports){function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}module.exports=isArguments},{}],18:[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],19:[function(require,module,exports){var funcTag="[object Function]";var objectProto=Object.prototype;var objToString=objectProto.toString;function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=isFunction},{}],20:[function(require,module,exports){var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var objToString=objectProto.toString;var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}module.exports=isTypedArray},{}],21:[function(require,module,exports){var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");var reIsUint=/^\d+$/;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeKeys=getNative(Object,"keys");var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keys},{"lodash._getnative":16,"lodash.isarguments":17,"lodash.isarray":18}],22:[function(require,module,exports){var keys=require("lodash.keys");function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function pairs(object){object=toObject(object);var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}module.exports=pairs},{"lodash.keys":21}],23:[function(require,module,exports){var arrayEach=require("lodash._arrayeach"),baseCallback=require("lodash._basecallback"),baseCreate=require("lodash._basecreate"),baseFor=require("lodash._basefor"),isArray=require("lodash.isarray"),isFunction=require("lodash.isfunction"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys");function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=baseCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}module.exports=transform},{"lodash._arrayeach":10,"lodash._basecallback":11,"lodash._basecreate":12,"lodash._basefor":13,"lodash.isarray":18,"lodash.isfunction":19,"lodash.istypedarray":20,"lodash.keys":21}],24:[function(require,module,exports){(function(isNode){var Public=function(clone){return merge(clone===true,false,arguments)},publicName="merge";Public.recursive=function(clone){return merge(clone===true,true,arguments)};Public.clone=function(input){var output=input,type=typeOf(input),index,size;if(type==="array"){output=[];size=input.length;for(index=0;index<size;++index)output[index]=Public.clone(input[index])}else if(type==="object"){output={};for(index in input)output[index]=Public.clone(input[index])}return output};function merge_recursive(base,extend){if(typeOf(base)!=="object")return extend;for(var key in extend){if(typeOf(base[key])==="object"&&typeOf(extend[key])==="object"){base[key]=merge_recursive(base[key],extend[key])}else{base[key]=extend[key]}}return base}function merge(clone,recursive,argv){var result=argv[0],size=argv.length;if(clone||typeOf(result)!=="object")result={};for(var index=0;index<size;++index){var item=argv[index],type=typeOf(item);if(type!=="object")continue;for(var key in item){var sitem=clone?Public.clone(item[key]):item[key];if(recursive){result[key]=merge_recursive(result[key],sitem)}else{result[key]=sitem}}}return result}function typeOf(input){return{}.toString.call(input).slice(8,-1).toLowerCase()}if(isNode){module.exports=Public}else{window[publicName]=Public}})(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports)},{}],25:[function(require,module,exports){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}},{}],26:[function(require,module,exports){var Emitter=require("emitter");var reduce=require("reduce");var root;if(typeof window!=="undefined"){root=window}else if(typeof self!=="undefined"){root=self}else{root=this}function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}request.getXHR=function(){if(root.XMLHttpRequest&&(!root.location||"file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false};var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.req.method!="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType==="undefined"?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text?this.text:this.xhr.response):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parse=function(fn){this.parser=fn;return this};Response.prototype.parseBody=function(str){var parse=this.parser||request.parse[this.type];return parse&&str&&(str.length||str instanceof Object)?parse(str):null};Response.prototype.setStatusProperties=function(status){if(status===1223){status=204}var type=status/100|0;this.status=this.statusCode=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var url=req.url;var msg="cannot "+method+" "+url+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.url=url;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var err=null;var res=null;try{res=new Response(self)}catch(e){err=new Error("Parser is unable to parse the response");err.parse=true;err.original=e;return self.callback(err)}self.emit("response",res);if(err){return self.callback(err,res)}if(res.status>=200&&res.status<300){return self.callback(err,res)}var new_err=new Error(res.statusText||"Unsuccessful HTTP response");new_err.original=err;new_err.response=res;new_err.status=res.status;self.callback(new_err,res)})}Emitter(Request.prototype);Request.prototype.use=function(fn){fn(this);return this};Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.unset=function(field){delete this._header[field.toLowerCase()];delete this.header[field];return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.field=function(name,val){if(!this._formData)this._formData=new root.FormData;this._formData.append(name,val);return this};Request.prototype.attach=function(field,file,filename){if(!this._formData)this._formData=new root.FormData;this._formData.append(field,file,filename);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj||isHost(data))return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;this.clearTimeout();fn(err,res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=request.getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._formData||this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;var status;try{status=xhr.status}catch(e){status=0}if(0==status){if(self.timedout)return self.timeoutError();if(self.aborted)return;return self.crossDomainError()}self.emit("end")};var handleProgress=function(e){if(e.total>0){e.percent=e.loaded/e.total*100}self.emit("progress",e)};if(this.hasListeners("progress")){xhr.onprogress=handleProgress}try{if(xhr.upload&&this.hasListeners("progress")){xhr.upload.onprogress=handleProgress}}catch(e){}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.timedout=true;self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var contentType=this.getHeader("Content-Type");var serialize=request.serialize[contentType?contentType.split(";")[0]:""];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}this.emit("request",this);xhr.send(data);return this};Request.prototype.then=function(fulfill,reject){return this.end(function(err,res){err?reject(err):fulfill(res)})};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request},{emitter:9,reduce:25}],27:[function(require,module,exports){module.exports=toNoCase;var hasSpace=/\s/;var hasCamel=/[a-z][A-Z]/;var hasSeparator=/[\W_]/;function toNoCase(string){if(hasSpace.test(string))return string.toLowerCase();if(hasSeparator.test(string))string=unseparate(string);if(hasCamel.test(string))string=uncamelize(string);return string.toLowerCase()}var separatorSplitter=/[\W_]+(.|$)/g;function unseparate(string){return string.replace(separatorSplitter,function(m,next){return next?" "+next:""})}var camelSplitter=/(.)([A-Z]+)/g;function uncamelize(string){return string.replace(camelSplitter,function(m,previous,uppers){return previous+" "+uppers.toLowerCase().split("").join(" ")})}},{}],28:[function(require,module,exports){var toSpace=require("to-space-case");module.exports=toSnakeCase;function toSnakeCase(string){return toSpace(string).replace(/\s/g,"_")}},{"to-space-case":29}],29:[function(require,module,exports){var clean=require("to-no-case");module.exports=toSpaceCase;function toSpaceCase(string){return clean(string).replace(/[\W_]+(.|$)/g,function(matches,match){return match?" "+match:""})}},{"to-no-case":27}]},{},[1]);
